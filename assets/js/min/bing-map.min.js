function Noo_Bing_Map(){function r(r,s){Microsoft.Maps.loadModule("Microsoft.Maps.Clustering",function(e){for(var t=[],a=c(),o=0;o<s.length;o++)if(""!=s[o].latitude||""!=s[o].longitude){var i=s[o].icon;""==s[o].category&&(i=nooGmapL10n.theme_uri+"/assets/images/marker-icon.png");var n=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(s[o].latitude,s[o].longitude),{icon:i});n.Title='<h6><a href="'+s[o].url+'">'+s[o].title+"</a></h6>",n.Description='<div class="bmap-infobox">                                <div class="info-img"><a href="'+s[o].url+'">'+s[o].image+'</a></div>                                 <div class="info-summary">                                     <h5 class="info-title"><a href="'+s[o].url+'">'+s[o].title+"</a></h5>",n.Description+='<div class="info-detail"><div class="bedrooms"><span class="property-meta-icon" style="background-image: url('+NooPropertyBingMap.icon_bedrooms+');"></span><span class="property-meta">'+s[o].bedrooms+'</span></div><div class="bathrooms"><span class="property-meta-icon" style="background-image: url('+NooPropertyBingMap.icon_bathrooms+');"></span><span class="property-meta">'+s[o].bathrooms+'</span></div><div class="area"><span class="property-meta-icon" style="background-image: url('+NooPropertyBingMap.icon_area+');"></span><span class="property-meta">'+s[o].area+"</span></div></div>",n.Description+='<div class="info-more">                                 <div class="info-price">'+s[o].price_html+'</div>                                 <div class="info-action"><a href="'+s[o].url+'"><i class="fa fa-plus"></i></a></div>',n.Description+="</div>                            </div>",Microsoft.Maps.Events.addHandler(n,"click",l),Microsoft.Maps.Events.addHandler(n,"click",function(e){return r.setView({center:e.target.getLocation(),zoom:r.getZoom()+1})}),n.metadata=s[o],d(n.metadata,a)&&t.push(n)}clusterLayer=new Microsoft.Maps.ClusterLayer(t,{clusteredPinCallback:p}),r.layers.insert(clusterLayer)})}function l(e){"pushpin"==e.targetType&&(n.setLocation(e.target.getLocation()),n.setOptions({visible:!0,description:e.target.Description,maxWidth:480,maxHeight:300}))}function p(e){var t=nooGmapL10n.theme_uri+"/assets/images/cloud.png",a=e.containedPushpins.length,o=Math.log(a)/Math.log(10)*5+30;e.setOptions({icon:t,textOffset:new Microsoft.Maps.Point(0,o-5)}),Microsoft.Maps.Events.addHandler(e,"click",i)}function i(e){if(e.target.containedPushpins){for(var t=[],a=0,o=e.target.containedPushpins.length;a<o;a++)t.push(e.target.containedPushpins[a].getLocation());var i=Microsoft.Maps.LocationRect.fromLocations(t);h.setView({bounds:i,padding:100}),0==i.width&&function(e){var t=[];if(e.containedPushpins){t.push('<div style="overflow-y:auto;"><ul class="bmap-listCluster" style="list-style:none;"');for(var a=0;a<e.containedPushpins.length;a++)t.push('<li><h6><a href="'+e.containedPushpins[a].metadata.url+'">',e.containedPushpins[a].metadata.title,'</a></h6><div><a href="'+e.containedPushpins[a].metadata.url+'">'+e.containedPushpins[a].metadata.image+"</div></li>");t.push("</ul></div>")}n.setOptions({title:e.getTitle(),location:e.getLocation(),description:t.join(""),visible:!0,maxWidth:500,maxHeight:280})}(e.target)}}function c(){return $(".gsearchform").serializeArray()}function e(){var e=[];if(e.length=0,clusterLayer.clear(),0<m.length){for(var t=c(),a=0,o=0;o<m.length;o++){var i=m[o];d(i,t)&&(e.push(i),a++)}if(Array.isArray(e)&&0!==e.length&&(r(h,e),e.length>=a)){var n=Microsoft.Maps.LocationRect.fromLocations(e);h.setView({bounds:n,zoom:0})}}}function d(i,n){if(null==i||void 0===i)return!1;if(null==n||void 0===n)return!1;var r=!1;return $.each(n,function(e,t){if(null==n[e].name||void 0===n[e].name)return!1;if(null==n[e].value||void 0===n[e].value)return!1;var a=n[e].name.toLocaleLowerCase(),o=n[e].value.toLocaleLowerCase();if(-1!==a.indexOf("[]")&&(a=a.replace("[]","")),"IDX"===s){if("idx-q-locations"===a&&-1===i.title.toLocaleLowerCase().indexOf(o))return!(r=!0);if("idx-q-pricemin"===a&&parseInt(i.price)<parseInt(o))return!(r=!0);if("idx-q-pricemax"===a&&parseInt(i.price)>parseInt(o))return!(r=!0);if("idx-q-bathsmin"===a&&parseInt(i.bathrooms)<parseInt(o))return!(r=!0);if("idx-q-bedsmin"===a&&parseInt(i.bedrooms)<parseInt(o))return!(r=!0)}else if("property"===s){if(""!==o&&"keyword"===a&&-1==i.title.toLocaleLowerCase().indexOf(o))return!(r=!0);if("location"===a&&(o=o.replace(/ /g,"-")),"city"===a&&(o=o.replace(/ /g,"-")),""!==o&&"keyword"===a&&-1===i.title.toLocaleLowerCase().indexOf(o))return!(r=!0);if("min_price"===a&&""!==o&&parseInt(i.price)<parseInt(o))return!(r=!0);if("max_price"===a&&""!==o&&parseInt(i.price)>parseInt(o))return!(r=!0);if("min_area"===a&&""!==o&&parseInt(i.area)<parseInt(o))return!(r=!0);if("max_area"===a&&""!==o&&parseInt(i.area)>parseInt(o))return!(r=!0);if("bathrooms"===a&&""!==o&&parseInt(i.bathrooms)<parseInt(o))return!(r=!0);if("bedrooms"===a&&""!==o&&parseInt(i.bedrooms)<parseInt(o))return!(r=!0);if(""!==o&&null!==o&&void 0!==i[a])if($.isArray(i[a])){if("category"===a&&-1===i.category.indexOf(o))return!(r=!0);if("location"===a&&-1===i.location.indexOf(o))return!(r=!0);if(-1===$.inArray(o,i[a]))return!(r=!0)}else if("location"===a){if(i.location.toString().toLocaleLowerCase().replace(/ /g,"-").replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a").replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e").replace(/ì|í|ị|ỉ|ĩ/g,"i").replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o").replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u").replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y").replace(/đ/g,"d").replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g,"A").replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g,"E").replace(/Ì|Í|Ị|Ỉ|Ĩ/g,"I").replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g,"O").replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g,"U").replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g,"Y").replace(/Đ/g,"D")!==o)return!(r=!0)}else if(o!==i[a])return!(r=!0)}}),!r}var t=jQuery(".noo_property_bing_map");if(0<t.length&&t.each(function(e,t){function o(e){var t=e[0].getLocation();document.getElementById("_noo_property_bmap_latitude").value=t.latitude,document.getElementById("_noo_property_bmap_longitude").value=t.longitude}function a(e){var t=new Microsoft.Maps.Map(document.getElementById(i),{center:new Microsoft.Maps.Location(e.location.latitude,e.location.latitude),zoom:n});t.entities.clear(),t.setView({bounds:e.bestView});t.getCenter();var a=[new h(new f(e.location.latitude,e.location.longitude),{icon:"https://www.bingmapsportal.com/Content/images/poi_custom.png",draggable:!0})];t.entities.push(a),m.addHandler(a[0],"dragend",function(){o(a)}),document.getElementById("_noo_property_bmap_latitude").value=e.location.latitude,document.getElementById("_noo_property_bmap_longitude").value=e.location.longitude}var i=jQuery(this).data("id"),n=parseInt(nooBingMap.zoom),r=parseFloat(nooBingMap.latitude),s=parseFloat(nooBingMap.longitude),l=jQuery("#latitude").val(),p=jQuery("#longitude").val();void 0!==l&&""!==l&&(r=parseFloat(l)),void 0!==p&&""!==p&&(s=parseFloat(p));var c=jQuery("#_noo_property_bmap_latitude").val(),d=jQuery("#_noo_property_bmap_longitude").val();void 0!==c&&""!==c&&(r=parseFloat(c)),void 0!==d&&""!==d&&(s=parseFloat(d));var u=new Microsoft.Maps.Map(document.getElementById(i),{center:new Microsoft.Maps.Location(r,s),zoom:n,disableScrollWheelZoom:!0}),g=u.getCenter(),m=Microsoft.Maps.Events,f=Microsoft.Maps.Location,h=Microsoft.Maps.Pushpin,v=[new h(new f(g.latitude,g.longitude),{icon:"https://www.bingmapsportal.com/Content/images/poi_custom.png",draggable:!0})];u.entities.push(v),m.addHandler(v[0],"dragend",function(){o(v)}),Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",function(){var e={maxResults:4,map:u};new Microsoft.Maps.AutosuggestManager(e).attachAutosuggest("#noo_property_bing_map_search_input",".noo_property_bing_map_search",a)})}),0<jQuery(".bmap").length){var n,a=jQuery(".noo-map-search"),o=a.find(".bmap").data("id"),s=a.find(".bmap").data("source"),u=parseFloat(nooGmapL10n.latitude),g=parseFloat(nooGmapL10n.longitude),m=[],f=parseFloat(nooGmapL10n.zoom),h=new Microsoft.Maps.Map(document.getElementById(o),{center:new Microsoft.Maps.Location(u,g),zoom:f,disableScrollWheelZoom:!0});if(a.find(".gmap-loading").hide(),a.find(".gmap-loader").hide(),"IDX"==s){c();if("object"==typeof dsidx&&!$.isEmptyObject(dsidx.dataSets)){var v=null;$.each(dsidx.dataSets,function(e,t){if(e)return v=e,!1});for(var y=0;y<dsidx.dataSets[v].length;y++){var M=dsidx.dataSets[v][y];new google.maps.LatLng(M.Latitude,M.Longitude);if(void 0!==M.ShortDescription){var _=M.ShortDescription.split(",");M.city=_[1],M.title=_[0]+", "+_[1]}else M.title=M.Address,M.city=M.City;M.latitude=M.Latitude,M.longitude=M.Longitude,M.bathrooms=parseInt(M.BedsShortString.charAt(0)),M.bedrooms=parseInt(M.BathsShortString.charAt(0)),M.url=nooGmapL10n.url_idx+M.PrettyUriForUrl,M.image='<img src="'+M.PhotoUriBase+M.PhotoFileName+'" alt="'+M.title+'">',M.price=parseFloat(M.Price.replace(/[^\d.]/g,"")),M.price_html=M.Price,M.area=M.ImprovedSqFt+" "+nooGmapL10n.area_unit,M.icon=nooGmapL10n.theme_uri+"/assets/images/marker-icon.png",m.push(M)}}}else m=JSON.parse(nooGmapL10n.markers);(n=new Microsoft.Maps.Infobox(h.getCenter(),{visible:!1})).setMap(h),"IDX"==s?(jQuery(".gsearch").find(".dropdown-menu > li > a").on("click",function(e){e.stopPropagation(),e.preventDefault();var t=jQuery(this).closest(".dropdown"),a=jQuery(this).data("value");t.children("input").val(a),t.children("input").trigger("change"),t.children('[data-toggle="dropdown"]').text($(this).text())}),jQuery(".noo-map").length&&jQuery(".noo-map").each(function(){jQuery(this).hasClass("no-gmap")||jQuery(this).find(".gsearch").find(".gsearch-field").find(":input").on("change",function(){e()})})):jQuery(".gsearchform").find(".gsearch-field").find(":input").on("change",function(){e()}),r(h,m)}}
jQuery(document).ready(function(a){var e={init:function(){window.nooImgUploadCount=a("#uploaded-images .uploaded-img").length,this.maxFiles=parseInt(noo_img_upload.max_files),a("#uploaded-images").on("click","a.remove-img",this.removeUploads),a("#uploaded-images").on("click","img",this.setFeatured),a("#gallery").length>0&&a("#uploaded-images").sortable({stop:e.updateOrder}),this.attach(),this.hideUploader()},attach:function(){if("undefined"!=typeof plupload){var i=new plupload.Uploader(noo_img_upload.plupload);a("#aaiu-uploader").click(function(a){i.start(),a.preventDefault()}),i.init(),i.bind("FilesAdded",function(e,d){a.each(d,function(e,i){a("#aaiu-upload-imagelist").append('<div id="'+i.id+'" class="ui-state-default">'+i.name+" ("+plupload.formatSize(i.size)+") <b></b></div>")}),e.refresh(),i.start()}),i.bind("UploadProgress",function(e,i){a("#"+i.id+" b").html(i.percent+"%")}),i.bind("Error",function(e,i){a("#aaiu-upload-imagelist").append("<div>Error: "+i.code+", Message: "+i.message+(i.file?", File: "+i.file.name:"")+"</div>"),e.refresh()}),i.bind("FileUploaded",function(i,d,o){var t=a.parseJSON(o.response);if(a("#"+d.id).remove(),t.success){if(window.nooImgUploadCount+=1,a("#gallery").length>0){var l=a("#gallery").val();if(l=""===l?t.image_id:l+","+t.image_id,a("#gallery").val(l),a("#uploaded-images").append('<div class="uploaded-img" data-imageid="'+t.image_id+'"><img src="'+t.thumbnail+'" /><a href="javascript:void(0)" class="remove-img"><i class="remove-img fa fa-trash-o"></i></a></div>'),0===a("#uploaded-images .featured-img").length){var n=a("#uploaded-images .uploaded-img:first-child");n.append('<i class="featured-img fa fa-star"></i>'),a("input#featured_img").val(n.attr("data-imageid"))}a("#uploaded-images").sortable({stop:e.updateOrder})}a("#avatar").length>0&&(a("#avatar").val(t.image_id),a("#uploaded-images").empty().append('<div class="uploaded-img" data-imageid="'+t.image_id+'"><img src="'+t.thumbnail+'" /></div>'),a(".user-sidebar-menu .user-avatar > img").attr("src",t.image)),e.hideUploader()}})}},hideUploader:function(){0!==e.maxFiles&&window.nooImgUploadCount>=e.maxFiles&&a("#aaiu-uploader").hide()},removeUploads:function(i){if(i.preventDefault(),confirm(noo_img_upload.confirmMsg)){var d=a(this),o={attach_id:d.parent().attr("data-imageid"),nonce:noo_img_upload.remove,action:"noo_delete_file"};a.post(noo_img_upload.ajaxurl,o,function(){d.parent().remove(),window.nooImgUploadCount-=1,0!==e.maxFiles&&window.nooImgUploadCount<e.maxFiles&&a("#aaiu-uploader").show()})}},setFeatured:function(){a("#uploaded-images .featured-img").each(function(){a(this).remove()}),a(this).parent().append('<i class="featured-img fa fa-star"></i>'),a("input#featured_img").val(a(this).parent().attr("data-imageid"))},updateOrder:function(){var e=[];a("#uploaded-images .uploaded-img").each(function(){void 0!==this&&void 0!==a(this).data("imageid")&&e.push(a(this).data("imageid"))}),a("#gallery").val(e.join(","))}};e.init()});